<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üö® –°–∏–≥–Ω–∞–ª–∏–∑–∞—Ü–∏—è - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
      color: #333;
    }
    
    .container {
      max-width: 800px;
      margin: 0 auto;
    }
    
    header {
      text-align: center;
      color: white;
      margin-bottom: 30px;
    }
    
    header h1 {
      font-size: 36px;
      margin-bottom: 10px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }
    
    .status-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      margin-bottom: 20px;
    }
    
    .card {
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 8px 16px rgba(0,0,0,0.2);
      transition: transform 0.3s, box-shadow 0.3s;
    }
    
    .card:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 24px rgba(0,0,0,0.3);
    }
    
    .card h3 {
      color: #667eea;
      margin-bottom: 15px;
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    
    .status-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 0;
      border-bottom: 1px solid #eee;
    }
    
    .status-item:last-child {
      border-bottom: none;
    }
    
    .status-label {
      font-weight: 600;
      color: #555;
    }
    
    .status-value {
      padding: 6px 12px;
      border-radius: 6px;
      font-weight: bold;
      font-size: 14px;
    }
    
    .status-on {
      background: #d4edda;
      color: #155724;
    }
    
    .status-off {
      background: #f8d7da;
      color: #721c24;
    }
    
    .status-warn {
      background: #fff3cd;
      color: #856404;
    }
    
    .temp-display {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 20px;
      border-radius: 12px;
      text-align: center;
      font-size: 28px;
      font-weight: bold;
      margin-top: 15px;
    }
    
    .controls {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-top: 20px;
    }
    
    button {
      padding: 12px;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(0,0,0,0.2);
    }
    
    button:active {
      transform: translateY(0);
    }
    
    .btn-primary {
      background: #667eea;
      color: white;
      grid-column: 1 / -1;
    }
    
    .btn-success {
      background: #28a745;
      color: white;
    }
    
    .btn-danger {
      background: #dc3545;
      color: white;
    }
    
    .btn-info {
      background: #17a2b8;
      color: white;
    }
    
    .full-width {
      grid-column: 1 / -1;
    }
    
    .history {
      background: white;
      border-radius: 12px;
      padding: 20px;
      margin-top: 20px;
      box-shadow: 0 8px 16px rgba(0,0,0,0.2);
    }
    
    .history h3 {
      color: #667eea;
      margin-bottom: 15px;
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    
    .event {
      padding: 10px;
      margin-bottom: 8px;
      border-left: 4px solid #999;
      border-radius: 4px;
      font-size: 13px;
      background: #f8f9fa;
    }
    
    .event.success {
      border-color: #28a745;
      background: #d4edda;
      color: #155724;
    }
    
    .event.danger {
      border-color: #dc3545;
      background: #f8d7da;
      color: #721c24;
    }
    
    .event.warning {
      border-color: #ffc107;
      background: #fff3cd;
      color: #856404;
    }
    
    .event.info {
      border-color: #17a2b8;
      background: #d1ecf1;
      color: #0c5460;
    }
    
    .event-time {
      font-weight: bold;
      margin-right: 10px;
      color: #666;
    }
    
    .last-update {
      text-align: center;
      color: #999;
      font-size: 12px;
      margin-top: 20px;
    }
    
    @media (max-width: 600px) {
      .status-grid {
        grid-template-columns: 1fr;
      }
      
      header h1 {
        font-size: 24px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>üö® –°–ò–ì–ù–ê–õ–ò–ó–ê–¶–ò–Ø</h1>
      <p>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–∏—Å—Ç–µ–º—ã</p>
    </header>
    
    <div class="status-grid">
      <!-- –°–û–°–¢–û–Ø–ù–ò–ï -->
      <div class="card">
        <h3>–°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã</h3>
        <div class="status-item">
          <span class="status-label">–û—Ö—Ä–∞–Ω–∞</span>
          <span class="status-value" id="armed">–í–´–ö–õ</span>
        </div>
        <div class="status-item">
          <span class="status-label">–¢—Ä–µ–≤–æ–≥–∞</span>
          <span class="status-value" id="alarm">–ù–ï–¢</span>
        </div>
        <div class="status-item">
          <span class="status-label">–ü–∏—Ç–∞–Ω–∏–µ –û–°–ù</span>
          <span class="status-value" id="main">–ï–°–¢–¨</span>
        </div>
        <div class="status-item">
          <span class="status-label">–ü–∏—Ç–∞–Ω–∏–µ –†–ï–ó</span>
          <span class="status-value" id="backup">–ï–°–¢–¨</span>
        </div>
        <div class="temp-display" id="temp">–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: 23.4¬∞C</div>
      </div>
      
      <!-- –£–ü–†–ê–í–õ–ï–ù–ò–ï –û–•–†–ê–ù–û–ô -->
      <div class="card">
        <h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ö—Ä–∞–Ω–æ–π</h3>
        <div class="controls">
          <button class="btn-success" onclick="sendCommand('arm')">‚úì –û–•–†–ê–ù–ê –í–ö–õ</button>
          <button class="btn-danger" onclick="sendCommand('disarm')">‚úó –û–•–†–ê–ù–ê –í–´–ö–õ</button>
          <button class="btn-danger full-width" onclick="sendCommand('alarm_reset')">üîî –°–ë–†–û–° –¢–†–ï–í–û–ì–ò</button>
        </div>
      </div>
      
      <!-- –ù–ê–ì–†–£–ó–ö–ò -->
      <div class="card">
        <h3>–ù–∞–≥—Ä—É–∑–∫–∏</h3>
        <div class="controls">
          <button class="btn-info" onclick="sendCommand('load1_on')">üí° –ù–ê–ì–†–£–ó–ö–ê 1 –í–ö–õ</button>
          <button class="btn-danger" onclick="sendCommand('load1_off')">üí° –ù–ê–ì–†–£–ó–ö–ê 1 –í–´–ö–õ</button>
          <button class="btn-info" onclick="sendCommand('load2_on')">üí° –ù–ê–ì–†–£–ó–ö–ê 2 –í–ö–õ</button>
          <button class="btn-danger" onclick="sendCommand('load2_off')">üí° –ù–ê–ì–†–£–ó–ö–ê 2 –í–´–ö–õ</button>
        </div>
      </div>
    </div>
    
    <!-- –ò–°–¢–û–†–ò–Ø –°–û–ë–´–¢–ò–ô -->
    <div class="history">
      <h3>–ò—Å—Ç–æ—Ä–∏—è —Å–æ–±—ã—Ç–∏–π</h3>
      <div id="eventList"></div>
    </div>
    
    <div class="last-update">
      –ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: <span id="lastUpdate">–Ω–∏–∫–æ–≥–¥–∞</span>
    </div>
  </div>
  
  <script>
    // ===== –§–£–ù–ö–¶–ò–ò =====
    async function sendCommand(cmd) {
      try {
        const response = await fetch('/api/command', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ command: cmd })
        });
        
        if (response.ok) {
          updateStatus();
          loadHistory();
        }
      } catch (e) {
        console.error('–û—à–∏–±–∫–∞:', e);
      }
    }
    
    async function updateStatus() {
      try {
        const response = await fetch('/api/status');
        const data = await response.json();
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
        setStatus('armed', data.armed ? '‚úì –í–ö–õ' : '‚úó –í–´–ö–õ', data.armed);
        setStatus('alarm', data.alarm ? '‚ö†Ô∏è –î–ê' : '‚úó –ù–ï–¢', data.alarm);
        setStatus('main', data.mainPower ? '‚úì –ï–°–¢–¨' : '‚úó –ù–ï–¢', data.mainPower);
        setStatus('backup', data.resPower ? '‚úì –ï–°–¢–¨' : '‚úó –ù–ï–¢', data.resPower);
        
        document.getElementById('temp').textContent = 
          `–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: ${data.temperature}¬∞C`;
        
        document.getElementById('lastUpdate').textContent = 
          new Date(data.timestamp).toLocaleTimeString('ru-RU');
        
        // –û—Å–æ–±—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
        if (data.alarm) {
          document.body.style.backgroundColor = 'rgba(220, 53, 69, 0.3)';
        }
        
      } catch (e) {
        console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞:', e);
      }
    }
    
    function setStatus(id, text, on) {
      const el = document.getElementById(id);
      el.textContent = text;
      el.className = 'status-value ' + (on ? 'status-on' : 'status-off');
      
      // –ï—Å–ª–∏ –ø–∏—Ç–∞–Ω–∏–µ –≤—ã–∫–ª—é—á–µ–Ω–æ - –∫—Ä–∞—Å–∏–º –≤ –∂–µ–ª—Ç—ã–π
      if ((id === 'main' || id === 'backup') && !on) {
        el.className = 'status-value status-warn';
      }
    }
    
    async function loadHistory() {
      try {
        const response = await fetch('/api/history');
        const events = await response.json();
        
        const list = document.getElementById('eventList');
        list.innerHTML = '';
        
        events.reverse().forEach(event => {
          const div = document.createElement('div');
          div.className = `event ${event.type}`;
          div.innerHTML = `
            <span class="event-time">${event.time}</span>
            <span>${event.message}</span>
          `;
          list.appendChild(div);
        });
        
      } catch (e) {
        console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏:', e);
      }
    }
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    updateStatus();
    loadHistory();
    
    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 3 —Å–µ–∫—É–Ω–¥—ã
    setInterval(updateStatus, 3000);
    setInterval(loadHistory, 5000);
  </script>
</body>
</html>
